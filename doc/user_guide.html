<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Luke Valenty">
<title>Safe Arithmetic User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #d0d0d0;
  background-color: #151515;
}
pre.rouge .err {
  color: #151515;
  background-color: #ac4142;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #505050;
}
pre.rouge .cp {
  color: #f4bf75;
}
pre.rouge .nt {
  color: #f4bf75;
}
pre.rouge .o, pre.rouge .ow {
  color: #d0d0d0;
}
pre.rouge .p, pre.rouge .pi {
  color: #d0d0d0;
}
pre.rouge .gi {
  color: #90a959;
}
pre.rouge .gd {
  color: #ac4142;
}
pre.rouge .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kv {
  color: #aa759f;
}
pre.rouge .kc {
  color: #d28445;
}
pre.rouge .kt {
  color: #d28445;
}
pre.rouge .kd {
  color: #d28445;
}
pre.rouge .s, pre.rouge .sb, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1 {
  color: #90a959;
}
pre.rouge .sa {
  color: #aa759f;
}
pre.rouge .sr {
  color: #75b5aa;
}
pre.rouge .si {
  color: #8f5536;
}
pre.rouge .se {
  color: #8f5536;
}
pre.rouge .nn {
  color: #f4bf75;
}
pre.rouge .nc {
  color: #f4bf75;
}
pre.rouge .no {
  color: #f4bf75;
}
pre.rouge .na {
  color: #6a9fb5;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #90a959;
}
pre.rouge .ss {
  color: #90a959;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Safe Arithmetic User Guide</h1>
<div class="details">
<span id="author" class="author">Luke Valenty</span><br>
<span id="email" class="email"><a href="mailto:luke.valenty@intel.com">luke.valenty@intel.com</a></span><br>
<span id="revnumber">version 0.0,</span>
<span id="revdate">April 21, 2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_motivation">1. Motivation</a>
<ul class="sectlevel2">
<li><a href="#_numeric_type_support">1.1. Numeric Type Support</a></li>
<li><a href="#_library_inter_op">1.2. Library Inter-op</a>
<ul class="sectlevel3">
<li><a href="#_dimensional_analysis">1.2.1. Dimensional Analysis</a></li>
<li><a href="#_messaging">1.2.2. Messaging</a></li>
<li><a href="#_register_access">1.2.3. Register Access</a></li>
</ul>
</li>
<li><a href="#_similar_libraries">1.3. Similar Libraries</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_safe_arithmetic_environment">2.1. Safe Arithmetic Environment</a></li>
<li><a href="#_creating_safe_values">2.2. Creating Safe Values</a></li>
<li><a href="#_extracting_safe_values">2.3. Extracting Safe Values</a></li>
<li><a href="#_safe_arithmetic_requirements_dsl">2.4. Safe Arithmetic Requirements DSL</a>
<ul class="sectlevel3">
<li><a href="#_requirement_dsl_primitives">2.4.1. Requirement DSL Primitives</a></li>
<li><a href="#_requirement_dsl_operators">2.4.2. Requirement DSL Operators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_api_reference">3. API Reference</a>
<ul class="sectlevel2">
<li><a href="#_safevar">3.1. safe::var</a>
<ul class="sectlevel3">
<li><a href="#_member_constants">3.1.1. Member constants</a>
<ul class="sectlevel4">
<li><a href="#_requirement">3.1.1.1. <code>requirement</code></a></li>
</ul>
</li>
<li><a href="#_member_functions">3.1.2. Member functions</a>
<ul class="sectlevel4">
<li><a href="#_constructor">3.1.2.1. Constructor</a></li>
<li><a href="#_operator">3.1.2.2. operator=</a></li>
</ul>
</li>
<li><a href="#_non_member_functions">3.1.3. Non-member functions</a>
<ul class="sectlevel4">
<li><a href="#_operator_2">3.1.3.1. operator<=></a></li>
<li><a href="#_operator_3">3.1.3.2. operator==</a></li>
<li><a href="#_operator_4">3.1.3.3. operator+</a></li>
<li><a href="#_operator_5">3.1.3.4. operator-</a></li>
<li><a href="#_operator_6">3.1.3.5. operator*</a></li>
<li><a href="#_operator_7">3.1.3.6. operator/</a></li>
<li><a href="#_operator_8">3.1.3.7. operator%</a></li>
<li><a href="#_operator_9">3.1.3.8. operator&lt;&lt;</a></li>
<li><a href="#_operator_10">3.1.3.9. operator&gt;&gt;</a></li>
<li><a href="#_operator_11">3.1.3.10. operator|</a></li>
<li><a href="#_operator_12">3.1.3.11. operator&amp;</a></li>
<li><a href="#_operator_13">3.1.3.12. operator^</a></li>
<li><a href="#_abs">3.1.3.13. abs</a></li>
<li><a href="#_bit_width">3.1.3.14. bit_width</a></li>
<li><a href="#_min">3.1.3.15. min</a></li>
<li><a href="#_max">3.1.3.16. max</a></li>
<li><a href="#_clamp">3.1.3.17. clamp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_safedsl">3.2. <code>safe::dsl</code></a>
<ul class="sectlevel4">
<li><a href="#_operator_14">3.2.1. operator==</a></li>
<li><a href="#_operator_15">3.2.2. operator!=</a></li>
<li><a href="#_operator_16">3.2.3. operator<=</a></li>
<li><a href="#_operator_17">3.2.4. operator>=</a></li>
<li><a href="#_operator_18">3.2.5. operator||</a></li>
<li><a href="#_operator_19">3.2.6. operator&amp;&amp;</a></li>
<li><a href="#_operator_20">3.2.7. operator+</a></li>
<li><a href="#_operator_21">3.2.8. operator-</a></li>
<li><a href="#_operator_22">3.2.9. operator*</a></li>
<li><a href="#_operator_23">3.2.10. operator/</a></li>
<li><a href="#_operator_24">3.2.11. operator%</a></li>
<li><a href="#_abs_2">3.2.12. abs</a></li>
<li><a href="#_min_2">3.2.13. min</a></li>
<li><a href="#_max_2">3.2.14. max</a></li>
<li><a href="#_operator_25">3.2.15. operator&amp;</a></li>
<li><a href="#_operator_26">3.2.16. operator|</a></li>
<li><a href="#_operator_27">3.2.17. operator^</a></li>
<li><a href="#_operator_28">3.2.18. operator~</a></li>
<li><a href="#_operator_29">3.2.19. operator&lt;&lt;</a></li>
<li><a href="#_operator_30">3.2.20. operator&gt;&gt;</a></li>
</ul>
</li>
<li><a href="#_safearray">3.3. <code>safe::array</code></a></li>
<li><a href="#_safeinteger">3.4. <code>safe::integer</code></a></li>
<li><a href="#_algorithms">3.5. Algorithms</a></li>
</ul>
</li>
<li><a href="#_requirements_dsl_theory_of_operation">4. Requirements DSL Theory of Operation</a>
<ul class="sectlevel2">
<li><a href="#_subset_is_left_distributive_over_union_of_disjoint_intervals">4.1. Subset is Left Distributive Over Union of Disjoint Intervals</a></li>
<li><a href="#_subset_is_right_anti_distributive_over_union_of_disjoint_intervals">4.2. Subset is Right Anti-Distributive over Union of Disjoint Intervals</a></li>
<li><a href="#_subsets_of_unions_of_disjoint_intervals">4.3. Subsets of Unions of Disjoint Intervals</a></li>
<li><a href="#_cartesian_product_of_unions">4.4. Cartesian Product of Unions</a></li>
<li><a href="#_cartesian_product_is_distributive_over_union">4.5. Cartesian Product is Distributive Over Union</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_motivation">1. Motivation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>C++ represents numerical values with finite bounds and discrete steps, as do
all commonly used programming languages and processors. This is not a problem
as long as specific rules regarding overflow, underflow, and loss of precision
are meticulously followed. There are a number of guidelines and standards
published for functional safety and security that detail the rules for safe
arithmetic operations as well as many other concerns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.misra.org.uk/publications/">MISRA C and MISRA C++ Guidelines</a></p>
</li>
<li>
<p><a href="https://wiki.sei.cmu.edu/confluence/display/seccode/SEI+CERT+Coding+Standards">CERT C and CERT C++ Secure Coding Standards</a></p>
</li>
<li>
<p><a href="https://www.iso.org/standard/61134.html">ISO/IEC TS 17961:2013 (C Secure Coding Rules)</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/IEC_61508">IEC 61508 (Functional Safety of Electrical/Electronic/Programmable Electronic Safety-related Systems)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These publications represent a large investment in the safe application of
software, and for good reason. The consequences for such bugs can be catastrophic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Therac-25">Therac-25 radiotherapy machine</a>. An
integer overflow caused the machine to bypass software safety checks and
deliver deadly radiotherapy doses to patients.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Ariane_flight_V88">Ariane rocket flight V88</a>.
An integer overflow was caught, but lead to an exception that was handled
incorrectly, thus halting its inertial navigation system. This ultimately
led to the catastrophic destruction of the rocket and its payload.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Time_formatting_and_storage_bugs#Boeing">Boeing
787 computer crash</a>. Two different integer overflows caused either misleading
data to be displayed or systems crash.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are countless other functional bugs and security vulnerabilities all due
to unsafe arithmetic operations.</p>
</div>
<div class="paragraph">
<p>The Safe Arithmetic library is intended and designed to protect against unsafe
arithmetic operations. This includes overflow, underflow, and divide-by-zero.
It follows the "Valley of success" strategy; The natural state of a software
project utilizing the Safe Arithmetic library contains clear boundaries between
safe and unsafe arithmetic. Within the safe arithmetic environment the easiest
and simplest thing to do is also the safest thing to do. In this context,
arithmetic includes assignment and construction.</p>
</div>
<div class="sect2">
<h3 id="_numeric_type_support">1.1. Numeric Type Support</h3>
<div class="paragraph">
<p>The current version of the Safe Arithmetic library supports the following value
types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>C++20 integer primitives</p>
</li>
<li>
<p><code>safe::integer&lt;N&gt;</code> arbitrary precision integers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the future, it is likely support for the following numeric types will be
added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fixed point</p>
</li>
<li>
<p>Pointers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is unlikely that other numeric types, like <code>float</code> and <code>double</code> will be
supported in the near-term. They at least are not needed by the original author
of the library. That being said, pull-requests are more than welcome and we
greatly appreciate community involvement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_library_inter_op">1.2. Library Inter-op</h3>
<div class="sect3">
<h4 id="_dimensional_analysis">1.2.1. Dimensional Analysis</h4>
<div class="paragraph">
<p>Dimensional analysis libraries in C&#43;&#43; typically use the language&#8217;s type
system to enforce correct assignment of values with dimensions to variables
or function arguments and forbid nonsensical operations like adding a length
value to a temperature value. Multiplication and division operations of
differing dimensions are allowed and the resulting type represents a new unit
and dimension.</p>
</div>
<div class="paragraph">
<p>The Safe Arithmetic library also uses the C&#43;&#43; type system to enforce correct
operations by encoding the set of possible values in a <code>safe::var</code> 's type.
Operations on these <code>safe::var</code> s return new types with an updated set of
possible values. The actual runtime value is guaranteed to be within this set.</p>
</div>
<div class="paragraph">
<p>The C&#43;&#43; type system essentially supports sophisticated static analysis
through compilation of the code. It is additionally possible to leverage a
dimensional analysis library like <code>mp-units</code> as well as the Safe Arithmetic
library to further increase confidence in your code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_messaging">1.2.2. Messaging</h4>
<div class="paragraph">
<p>Intel&#8217;s Compile-time Initialization and Build library&#8217;s messaging capabilities
may also be used with great success with the Safe Arithmetic library. Message
fields may be given safe types to enforce correct assignment to fields as well
as provide field values that are already wrapped in safe types when read.</p>
</div>
</div>
<div class="sect3">
<h4 id="_register_access">1.2.3. Register Access</h4>
<div class="paragraph">
<p>Intel&#8217;s internal Config Register Operation Optimizer library may be used with
the Safe Arithmetic library to ensure safe and correct access of registers.
Without the Safe Arithmetic library, it is possible to write values too large
to be represented by a register field&#8217;s bit width. With the Safe Arithmetic
library, it is possible to ensure only values in range are written to fields
and field read types will also be automatically wrapped in an appropriately
constrained safe type.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_similar_libraries">1.3. Similar Libraries</h3>
<div class="paragraph">
<p>Safe Arithmetic is not the only library that attempts to solve the problem of
unsafe integer or numeric operations in programs. There are a number of other
libraries with different strategies and tradeoffs that are worthwhile to look
at.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/boostorg/safe_numerics">Boost&#8217;s safe_numerics</a>. A library
by Robert Ramey included in Boost. It works on the C&#43;&#43;14 standard rather than
C&#43;&#43;20 as required by Safe Arithmetic. It offers more customization points
on how exceptional cases are handled: compile-time, runtime exceptions, or a
custom error handler. It also allows customization for how integer promotion
is handled. It has been around longer than Safe Arithmetic. It only supports
intervals to specify value requirements, while Safe Arithmetic implements a
DSL to allow more tightly-constrained requirements.</p>
</li>
<li>
<p><a href="https://github.com/davidstone/bounded-integer">bounded::integer</a>. A library
by David Stone. Defines a <code>bounded::integer&lt;Min, Max&gt;</code> template type that
tracks the set of potential values of operations using interval math.
Implemented in C&#43;&#43;20 as modules.</p>
</li>
<li>
<p><a href="https://github.com/dcleblanc/SafeInt">SafeInt</a>. Provides both a C&#43;&#43;11 and C
library implementation. Appears to only support runtime checking.</p>
</li>
<li>
<p><a href="https://github.com/PeterSommerlad/PSsimplesafeint">PSsimplesafeint</a>.
"A C&#43;&#43;20 implementation of safe (wrap around) integers following MISRA
C&#43;&#43; rules."</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_safe_arithmetic_environment">2.1. Safe Arithmetic Environment</h3>
<div class="paragraph">
<p>The Safe Arithmetic library uses the C++ type system to encode and enforce
requirements on values. A special template type, <code>safe::var</code> is used to contain
these values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">namespaced</span> <span class="n">safe</span> <span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">ValueType</span><span class="p">,</span> <span class="k">auto</span> <span class="n">Requirements</span><span class="p">&gt;</span>
    <span class="k">struct</span> <span class="nc">var</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Arithmetic, bitwise, and shift operators on <code>safe::var</code> values results in
the generation of a new <code>safe::var</code> with its requirements updated to represent
the set of possible values the result may contain. Operations on <code>safe::var</code>
values are guaranteed to be safe at compile-time. There is no runtime overhead
incurred. Only the desired operations are performed.</p>
</div>
<div class="paragraph">
<p>Operations on instances of <code>safe::var</code> forms a hermetically sealed context in
which overflows, underflows, and division-by-zero are proven impossible by
the Safe Arithmetic library implementation. If such a condition were possible
due to an arithmetic operation on a <code>safe::var</code>, then compilation would fail.</p>
</div>
<div class="paragraph">
<p>This leaves two important questions, how to get values in and out of this "Safe
Arithmetic Environment".</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_safe_values">2.2. Creating Safe Values</h3>
<div class="paragraph">
<p>Safe literal values can be created using the <code>_i</code> user defined literal. It will
create a <code>safe::var</code> with the necessary integer type to contain the value and
a requirement that matches the value. Literal values larger than 64-bits are
implemented using an arbitrary precision integer type built into the Safe
Arithmetic library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">safe</span><span class="o">::</span><span class="n">literals</span> <span class="p">{</span>
    <span class="k">template</span> <span class="o">&lt;</span><span class="kt">char</span><span class="p">...</span> <span class="n">chars</span><span class="p">&gt;</span>
    <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="s">""</span><span class="n">_i</span><span class="p">();</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Safe versions of the C++ primitive integer types are available for declaring
runtime values. Each primitive integer type is wrapped in <code>safe::var</code> with a
requirement describing the range of that primitive type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">safe</span> <span class="p">{</span>
    <span class="c1">// safe versions of C++ primitive integer types</span>
    <span class="k">using</span> <span class="n">u8</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">s8</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int8_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">u16</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint16_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">s16</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int16_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">u32</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">s32</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int32_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">u64</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">s64</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int64_t</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because each safe primitive integer type requirement&#8217;s can contain all values
that are representable by the underlying type, it is safe to directly assign
primitive values to instances of these safe primitive types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// SAFE: The signed literal value is gauranteed to fit in a std::int64_t.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">s64</span> <span class="n">foo</span> <span class="o">=</span> <span class="mh">0xc001bea7</span><span class="p">;</span>

<span class="c1">// COMPILE ERROR: On systems with 32- or 64-bit int types, the literal will be</span>
<span class="c1">// too large to fit and compilation will fail.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">s16</span> <span class="n">bar_1</span> <span class="o">=</span> <span class="mh">0xba11</span><span class="p">;</span>

<span class="c1">// SAFE: The safe integer UDL encodes its requirements in its type, the value</span>
<span class="c1">// is known at compile-time to fit in bar_2.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">s16</span> <span class="n">bar_2</span> <span class="o">=</span> <span class="mh">0x5a5</span><span class="n">_i</span><span class="p">;</span>

<span class="c1">// SAFE: A safe 64-bit int can represent all values in an unsigned safe 16-bit int.</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">bar_1</span><span class="p">;</span>

<span class="c1">// SAFE: A safe 32-bit unsigned int can safely be assigned the value of a uint32_t</span>
<span class="k">volatile</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span> <span class="n">my_fav_reg</span><span class="p">;</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u32</span> <span class="n">safe_reg_val</span> <span class="o">=</span> <span class="n">my_fav_reg</span><span class="p">;</span>

<span class="c1">// SAFE: Masking safe_reg_val by an 8-bit value guarantees the result will fit</span>
<span class="c1">// in a safe::u8</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u8</span> <span class="n">safe_reg_field_val_1</span> <span class="o">=</span> <span class="n">safe_reg_val</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="n">_i</span><span class="p">;</span>

<span class="c1">// COMPILE ERROR: safe::u8 cannot represent all possible values of these rhs</span>
<span class="c1">// variables.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u8</span> <span class="n">safe_reg_field_val_2</span> <span class="o">=</span> <span class="n">safe_reg_val</span><span class="p">;</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u8</span> <span class="n">safe_reg_field_val_3</span> <span class="o">=</span> <span class="n">my_fav_reg</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For integer values that cannot fit in the primitive types provided by C++, the
Safe Arithmetic library provides an arbitrary precision implementation,
<code>safe::integer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">safe</span> <span class="p">{</span>
    <span class="c1">// safe arbitrary precision signed integer type</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">NumBits</span><span class="p">&gt;</span>
    <span class="k">using</span> <span class="n">integer</span> <span class="o">=</span> <span class="n">var</span><span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Safe Arithmetic&#8217;s integer promotion rules will automatically pick an integer
type large enough to represent the possible values of an arithmetic operation.
There is little need to explicitly use <code>safe::integer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">auto</span> <span class="n">big_int_value</span> <span class="o">=</span> <span class="mh">0xba5eball</span><span class="err">'</span><span class="n">d00d5a7e</span><span class="err">'</span><span class="n">a11f00d5</span><span class="err">'</span><span class="mi">900</span><span class="n">dg00b_i</span><span class="p">;</span>

<span class="c1">// SAFE: The result of the operation is known at compile time to fit.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u64</span> <span class="n">small_1</span> <span class="o">=</span> <span class="n">big_int_value</span> <span class="o">&gt;&gt;</span> <span class="mi">64</span><span class="n">_i</span><span class="p">;</span>

<span class="c1">// COMPILE ERROR: The result cannot be represented by a uint64_t.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u64</span> <span class="n">small_2</span> <span class="o">=</span> <span class="n">big_int_value</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="n">_i</span><span class="p">;</span>

<span class="k">volatile</span> <span class="n">safe</span><span class="o">::</span><span class="n">u64</span> <span class="n">hw_reg_1</span><span class="p">;</span>
<span class="k">volatile</span> <span class="n">safe</span><span class="o">::</span><span class="n">u64</span> <span class="n">hw_reg_2</span><span class="p">;</span>

<span class="c1">// SAFE: The result type is automatically promoted to a safe::integer&lt;66&gt;. The</span>
<span class="c1">// 66th bit is the two's complement sign bit and the 65th bit is the carry from</span>
<span class="c1">// the 64-bit addition.</span>
<span class="k">auto</span> <span class="n">reg_result</span> <span class="o">=</span> <span class="n">hw_reg_1</span> <span class="o">+</span> <span class="n">hw_reg_2</span><span class="p">;</span>

<span class="c1">// COMPILE ERROR: The addition of these unchecked values could overflow a</span>
<span class="c1">// safe:u64.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u64</span> <span class="n">reg_result_2</span> <span class="o">=</span> <span class="n">hw_reg_1</span> <span class="o">+</span> <span class="n">hw_reg2</span><span class="p">;</span>

<span class="c1">// SAFE: The result is explicitly being masked to 64-bits.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">u64</span> <span class="n">reg_result_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">hw_reg_1</span> <span class="o">+</span> <span class="n">hw_reg2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF'FFFF'FFFF'FFFF</span><span class="n">_i</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>safe::match</code> is the only mechanism in the Safe Arithmetic library that will
produce additional runtime overhead. It creates a callable object that may be
called with <code>safe::var</code> or naked integer values. It uses compile-time checks
if possible to match the given arguments with the <code>matchable_funcs</code> arguments.
If compile-time checks are not possible for an argument, then the value is
checked at runtime to determine if it satisfies the requirements for one of the
<code>matchable_funcs</code>. It is analogous to a pattern matching switch statement where
the <code>matchable_funcs</code> arguments <code>safe::var</code> requirements are the patterns to
match the callable object&#8217;s input arguments against.</p>
</div>
<div class="paragraph">
<p>This is the recommended way of marshalling external integer values into a safe
arithmetic environment when the valid values are a subset of the underlying
integer type&#8217;s range. For example, an external value arrives in a full 16-bit
unsigned integer, but the valid values are only 0 through 50,000. The full
16 bits are needed to represent the value, but only a subset of the 16-bit
integer range is valid.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Pseudo C++20 to illustrate safe::match API</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">F</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Return</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">NumArgs</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Callable</span> <span class="o">=</span> <span class="k">requires</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="k">auto</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Return</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="p">...);</span>
    <span class="k">requires</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="n">NumArgs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">namespace</span> <span class="n">safe</span> <span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Return</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">NumArgs</span><span class="p">&gt;</span>
    <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Return</span><span class="p">,</span> <span class="n">NumArgs</span><span class="o">&gt;</span> <span class="k">auto</span> <span class="n">match</span><span class="o">&lt;</span><span class="n">Return</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Return</span><span class="p">,</span> <span class="n">NumArgs</span><span class="o">&gt;</span> <span class="k">auto</span><span class="p">...</span> <span class="n">matchable_funcs</span><span class="p">,</span>
        <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Return</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;</span> <span class="k">auto</span> <span class="n">default_func</span>
    <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The operation of <code>safe::match</code> is easier to understand with some examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Hardware register reporting a count of some event type.</span>
<span class="k">volatile</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span> <span class="n">event_counter_hw_reg</span><span class="p">;</span>

<span class="c1">// Hardware register representing the event type being reported.</span>
<span class="k">volatile</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span> <span class="n">event_type_hw_reg</span><span class="p">;</span>

<span class="c1">// Firmware array keeping track of updated event counts.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">safe</span><span class="o">::</span><span class="n">u16</span><span class="p">,</span> <span class="mi">17</span><span class="o">&gt;</span> <span class="n">event_counts</span><span class="p">{};</span>

<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">process_event_count</span> <span class="o">=</span> <span class="n">safe</span><span class="o">::</span><span class="n">match</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="p">[](</span>
        <span class="n">safe</span><span class="o">::</span><span class="n">ival_u32</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="o">&gt;</span> <span class="n">event_count</span><span class="p">,</span>
        <span class="n">safe</span><span class="o">::</span><span class="n">ival_u32</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">event_type</span>
    <span class="p">){</span>
        <span class="k">auto</span> <span class="k">const</span> <span class="n">prev_count</span> <span class="o">=</span> <span class="n">event_counts</span><span class="p">[</span><span class="n">event_type</span><span class="p">];</span>
        <span class="k">auto</span> <span class="k">const</span> <span class="n">new_count</span> <span class="o">=</span> <span class="n">prev_count</span> <span class="o">+</span> <span class="n">event_count</span><span class="p">;</span>

        <span class="c1">// this example is making the implementation choice of saturating the</span>
        <span class="c1">// event count to prevent overflow and rollover.</span>
        <span class="n">event_counts</span><span class="p">[</span><span class="n">event_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">new_count</span><span class="p">,</span> <span class="n">safe</span><span class="o">::</span><span class="n">u16</span><span class="o">::</span><span class="n">max_value</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// Multiple functions with different requirements for parameters may be</span>
    <span class="c1">// passed in. The first function whose argument requirements are satisified</span>
    <span class="c1">// by the runtime argument values is executed. The last function must be</span>
    <span class="c1">// the default handler and is only executed if no prior match is found.</span>

    <span class="p">[](){</span>
        <span class="c1">// default action, handle error condition as desired</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Hardware triggers this interrupt every time a new event count is ready to</span>
<span class="c1">// be processed.</span>
<span class="kt">void</span> <span class="n">event_count_interrupt_handler</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">process_event_count</span><span class="p">(</span><span class="n">event_counter_hw_reg</span><span class="p">,</span> <span class="n">event_type_hw_reg</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>safe::match</code> is a powerful tool that is discussed in more detail in the
reference section.</p>
</div>
<div class="paragraph">
<p>The final method of introducing values into the safe arithmetic environment is
through <code>unsafe_cast&lt;T&gt;(value)</code>. It bypasses all compile-time and runtime
safety checks and depends on the value to be proven to satisfy the requirements
of <code>T</code> using mechanisms outside the visibility and scope of the Safe Arithmetic
library. Its use is highly discouraged. The name is chosen to cause an uneasy
feeling in programmers and clearly signal a red flag for code reviewers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">unsafe_cast</span><span class="p">(</span><span class="k">auto</span> <span class="n">value</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>unsafe_cast&lt;T&gt;(value)</code> is used within the Safe Arithmetic library to ferry
values into instances of <code>safe::var</code> after proving it is safe to do so. It is
necessary for the library&#8217;s construction.</p>
</div>
<div class="paragraph">
<p>As always, an example is useful to illustrate how to use a particular function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">std</span><span class="o">::</span><span class="kt">uint16_t</span> <span class="nf">some_function</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">do_something_useful</span><span class="p">(</span><span class="n">safe</span><span class="o">::</span><span class="n">ival_u32</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="o">&gt;</span> <span class="n">useful_value</span><span class="p">);</span>

<span class="c1">// VERY DANGEROUS: Don't do this!</span>
<span class="k">auto</span> <span class="n">dangerous_value</span> <span class="o">=</span> <span class="n">unsafe_cast</span><span class="o">&lt;</span><span class="n">safe</span><span class="o">::</span><span class="n">ival_u32</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">some_function</span><span class="p">());</span>
<span class="n">do_something_useful</span><span class="p">(</span><span class="n">dangerous_value</span><span class="p">);</span>

<span class="c1">// SAFE: Use safe::match instead. This will only call 'do_something_useful'</span>
<span class="c1">// if the result of 'some_function' satisfies the requirements on</span>
<span class="c1">// 'useful_value'. If it doesn't match, the default callable will be invoked.</span>
<span class="n">safe</span><span class="o">::</span><span class="n">match</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">(</span><span class="n">do_something_useful</span><span class="p">,</span> <span class="p">[](){})(</span><span class="n">some_function</span><span class="p">());</span>

<span class="c1">// SAFE: Don't use unsafe_cast&lt;T&gt;(value), try almost everything else first.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you find a case where you feel you must use <code>unsafe_cast</code>, then maybe there
is a gap in the Safe Arithmetic API or an algorithm that is missing. Please let
us know by filing an issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="_extracting_safe_values">2.3. Extracting Safe Values</h3>
<div class="paragraph">
<p>Extracting values out of the safe arithmetic environment is not dangerous or
unsafe in itself, but it is important to be explicit when doing so.
<code>safe_cast&lt;T&gt;(value)</code> is used to extract integer values out of <code>safe::vars</code>.
It is an acknowledgement by the programmer they are leaving the safe
environment and must now take on the burden of ensuring safe arithmetic
operations manually. It is also a clear indication for code reviewers to take a
more critical look at any following integer operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">safe_cast</span><span class="p">(</span><span class="k">auto</span> <span class="n">value</span><span class="p">);</span>

<span class="n">safe</span><span class="o">::</span><span class="n">ival_s32</span><span class="o">&lt;-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="o">&gt;</span> <span class="n">my_safe_value</span> <span class="o">=</span> <span class="mi">42</span><span class="n">_i</span><span class="p">;</span>

<span class="c1">// SAFE: It's OK to use safe_cast to assign to a wider primitive type</span>
<span class="k">auto</span> <span class="n">innocent_value</span> <span class="o">=</span> <span class="n">safe_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int32_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">my_safe_value</span><span class="p">);</span>

<span class="c1">// COMPILE ERROR: A narrowing conversion is not allowed by safe_cast</span>
<span class="k">auto</span> <span class="n">another_innocent</span> <span class="o">=</span> <span class="n">safe_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">my_safe_value</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_safe_arithmetic_requirements_dsl">2.4. Safe Arithmetic Requirements DSL</h3>
<div class="paragraph">
<p>The Requirements Domain-Specific Language is used to define the set of valid
values for a <code>safe::var&lt;T, Requirements&gt;</code> templated type. <code>safe_numerics</code> and
<code>bounded::integer</code> both use interval arithmetic at compile time to track the
set of valid values. The Safe Arithmetic library works with intervals, sets,
tristate bitmasks, and set operators like union, intersection, and difference
to define arbitrary requirements on values. Just like <code>safe_numerics</code> and
<code>bounded::integer</code>, it will calculate the new set of possible values for any
arithmetic, bitwise, or shift operation.</p>
</div>
<div class="paragraph">
<p>Since interval requirements are commonly used, there are convenience types for
creating them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">safe</span><span class="o">::</span><span class="n">ival_s32</span><span class="o">&lt;-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">&gt;</span> <span class="n">small_number</span><span class="p">{};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which is equivalent to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">safe</span><span class="o">::</span><span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">safe</span><span class="o">::</span><span class="n">ival</span><span class="o">&lt;-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">&gt;&gt;</span> <span class="n">small_number</span> <span class="o">=</span> <span class="mi">0</span><span class="n">_i</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to exclude '0' from the range, the DSL allows us to do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">using</span> <span class="n">safe</span><span class="o">::</span><span class="n">ival</span><span class="p">;</span>
<span class="n">safe</span><span class="o">::</span><span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">ival</span><span class="o">&lt;-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span> <span class="o">||</span> <span class="n">ival</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="o">&gt;&gt;</span> <span class="n">small_nonzero_number</span> <span class="o">=</span> <span class="mi">1</span><span class="n">_i</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This enables the library to protect against divide-by-zero at compile-time. The
division operator function arguments require the divisor to be non-zero.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// COMPILE ERROR: small_number _might_ be zero</span>
<span class="k">auto</span> <span class="n">result_1</span> <span class="o">=</span> <span class="mi">10</span><span class="n">_i</span> <span class="o">/</span> <span class="n">small_number</span><span class="p">;</span>

<span class="c1">// SAFE: small_nonzero_number is guaranteed to be non-zero.</span>
<span class="k">auto</span> <span class="n">result_2</span> <span class="o">=</span> <span class="mi">10</span><span class="n">_i</span> <span class="o">/</span> <span class="n">small_nonzero_number</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The DSL can be used by itself, outside of <code>safe::var</code>. This can be helpful to
illustrate the rules and capabilities of the DSL itself.</p>
</div>
<div class="paragraph">
<p>The assignment operator and constructors for <code>safe::var&lt;T, Req&gt;</code> that accept
another <code>safe::var&lt;RhsT, RhsReq&gt;</code> use set inequality operators to determine
whether it is safe or not. The right-hand-side argument&#8217;s requirements must
be a subset of the left-hand-side target.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">using</span> <span class="n">safe</span><span class="o">::</span><span class="n">ival</span><span class="p">;</span>

<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">non_zero_req</span> <span class="o">=</span> <span class="n">ival</span><span class="o">&lt;-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span> <span class="o">||</span> <span class="n">ival</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">small_num_req</span> <span class="o">=</span> <span class="n">ival</span><span class="o">&lt;-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// The `&lt;=` operator is used for 'is subset of'</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">non_zero_req</span> <span class="o">&lt;=</span> <span class="n">small_num_req</span><span class="p">);</span>

<span class="n">safe</span><span class="o">::</span><span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">non_zero_req</span><span class="o">&gt;</span> <span class="n">non_zero</span> <span class="o">=</span> <span class="mi">1</span><span class="n">_i</span><span class="p">;</span>

<span class="c1">// The `&lt;=` operator ensures this assignment is safe at compile-time</span>
<span class="n">safe</span><span class="o">::</span><span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">small_num_req</span><span class="o">&gt;</span> <span class="n">small_num</span> <span class="o">=</span> <span class="n">non_zero</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When any operation is performed on a <code>safe::var</code> instance, the mirror operation
is performed on the requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">using</span> <span class="n">safe</span><span class="o">::</span><span class="n">ival</span><span class="p">;</span>

<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">one_to_ten_req</span> <span class="o">=</span> <span class="n">ival</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">non_zero_req</span> <span class="o">=</span> <span class="n">ival</span><span class="o">&lt;-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span> <span class="o">||</span> <span class="n">ival</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">safe</span><span class="o">::</span><span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">non_zero_req</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">42</span><span class="n">_i</span><span class="p">;</span>
<span class="n">safe</span><span class="o">::</span><span class="n">var</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="kt">int32_t</span><span class="p">,</span> <span class="n">one_to_ten_req</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="n">_i</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>

<span class="c1">// runtime value is updated as expected</span>
<span class="n">assert</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">126</span><span class="n">_i</span><span class="p">);</span>

<span class="c1">// static requirements are also updated as expected</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">requirement</span> <span class="o">==</span> <span class="n">ival</span><span class="o">&lt;-</span><span class="mi">1000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span> <span class="o">||</span> <span class="n">ival</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="o">&gt;</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_requirement_dsl_primitives">2.4.1. Requirement DSL Primitives</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Definition</th>
<th class="tableblock halign-left valign-top">C&#43;&#43;</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$[a, b\$]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>safe::ival&lt;a, b&gt;</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of values from a to b, inclusive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a, b, c, ...}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>safe::set&lt;a, b, c, &#8230;&#8203;&gt;</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of explicitly defined values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Let V be an integer and V<sub>i</sub> be its i<sup>th</sup> binary digit
Let C be an integer and C<sub>i</sub> be its i<sup>th</sup> binary digit
Let x<sub>i</sub> be the i<sup>th</sup> binary digit of x
\${x in NN | 0 &lt;= x &lt; 2^n ^^ AAi (V_i vv (C_i = x_i))}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>safe::mask&lt;V, C&gt;</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V is the variable bits mask. C is the constant bits mask. <code>safe::mask</code>
produces a set of integers where the binary digits match C if the corresponding
digits of V are unset. The binary digit places that are set in V are
unconstrained in the elements of the produced set.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_requirement_dsl_operators">2.4.2. Requirement DSL Operators</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Definition</th>
<th class="tableblock halign-left valign-top">C&#43;&#43; Operator</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$A subseteq B\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A <= B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test if A is a subset of B.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Superset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$A supe B\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A &gt;= B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test if A is a superset of B.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Equality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$A = B\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A == B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test if A and B contain identical elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Inequality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$A != B\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A != B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test if A and B do not contain identical elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Union</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$A uu B\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A || B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of all elements in A and B.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Intersection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$A nn B\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A &amp;&amp; B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of common elements in A and B.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a + b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A + B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B added.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a - b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A - B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B subtracted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a * b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A * B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B multiplied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a / b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A / B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B divided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a % b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A % B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B modulo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${|a| | a in A}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>abs(A)</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of the absolute value of all elements in A.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${min(a, b) | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>min(A, B)</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of the minimum of each product pair of A and B.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${max(a, b) | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>max(A, B)</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of the maximum of each product pair of A and B.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a\ &amp;\ b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A &amp; B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B bitwise ANDed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a | b \ |\ a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A | B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B bitwise ORed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise XOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a\ o+\ b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A ^ B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B bitwise XORed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${~a | a in A}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>~A</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise NOT of all elements in A.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise Shift Left</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a " &lt;&lt; " b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A &lt;&lt; B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B bitwise shifted left.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise Shift Right</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${a " &gt;&gt; " b | a in A, b in B}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>A &gt;&gt; B</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of product pairs of A and B bitwise shifted right.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_reference">3. API Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_safevar">3.1. safe::var</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">safe</span> <span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">,</span> <span class="k">auto</span> <span class="n">Requirement</span><span class="p">&gt;</span>
    <span class="k">struct</span> <span class="nc">var</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>safe::var</code> wraps a runtime value with an associated <code>safe::dsl</code> requirement
describing the set of values it must be contained in. The requirement is used
to check the value at runtime or prove at compile-time it is satisfied.</p>
</div>
<div class="sect3">
<h4 id="_member_constants">3.1.1. Member constants</h4>
<div class="sect4">
<h5 id="_requirement">3.1.1.1. <code>requirement</code></h5>
<div class="paragraph">
<p>The <code>safe::dsl</code> requirement describing allowed values.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_member_functions">3.1.2. Member functions</h4>
<div class="sect4">
<h5 id="_constructor">3.1.2.1. Constructor</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">constexpr</span> <span class="nf">var</span><span class="p">()</span> <span class="k">requires</span><span class="p">(</span><span class="n">requirement</span> <span class="o">&gt;=</span> <span class="n">set</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Default constructor, only valid if the requirement allows a value of '0'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">U</span><span class="p">&gt;</span>
<span class="k">requires</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_convertable_v</span><span class="o">&lt;</span><span class="n">U</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span>
<span class="k">constexpr</span> <span class="nf">var</span><span class="p">(</span><span class="n">unsafe_cast_ferry</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="n">ferry</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unsafe constructor. Used to construct a <code>safe::var</code> bypassing all compile-time
and runtime checking mechanisms. Leads to undefined behavior if used
incorrectly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">constexpr</span> <span class="nf">var</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Construct a <code>safe::var</code> from another instance with potentially different,
but compatible requirements. Assignment safety is checked at compile time.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator">3.1.2.2. operator=</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">var</span> <span class="o">&amp;</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assign value from another instance with potentially different, but compatible
requirements. Assignment safety is checked at compile time.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_non_member_functions">3.1.3. Non-member functions</h4>
<div class="sect4">
<h5 id="_operator_2">3.1.3.1. operator<=></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&lt;=&gt;</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply <code>operator<=></code> to <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_3">3.1.3.2. operator==</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply <code>operator==</code> to <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_4">3.1.3.3. operator+</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are promoted to a wider type if the result would otherwise
overflow or underflow. No wraparound for signed or unsigned types.</p>
</div>
<div class="paragraph">
<p>Value types are demoted to a narrower type, down to the natural word size of
the underlying architecture, if all possible results will fit.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_5">3.1.3.4. operator-</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Subtract the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are promoted to a wider type if the result would otherwise
overflow or underflow. No wraparound for signed or unsigned types.</p>
</div>
<div class="paragraph">
<p>Value types are demoted to a narrower type, down to the natural word size of
the underlying architecture, if all possible results will fit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">v</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns <code>0_i - v</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_6">3.1.3.5. operator*</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiply the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are promoted to a wider type if the result would otherwise
overflow or underflow. No wraparound for signed or unsigned types.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_7">3.1.3.6. operator/</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Divide the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are demoted to a narrower type, down to the natural word size of
the underlying architecture, if all possible results will fit.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A compilation error will result if the <code>rhs</code> requirement doesn&#8217;t exclude '0'.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_operator_8">3.1.3.7. operator%</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">%</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Modulo the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are demoted to a narrower type, down to the natural word size of
the underlying architecture, if all possible results will fit.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A compilation error will result if the <code>rhs</code> requirement doesn&#8217;t exclude '0'.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_operator_9">3.1.3.8. operator&lt;&lt;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Shift <code>lhs</code> left by <code>rhs</code> bit positions and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are promoted to a wider type if the result would otherwise
overflow or underflow. No wraparound for signed or unsigned types.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A compilation error will result if the <code>rhs</code> requirement doesn&#8217;t exclude
all negative numbers or numbers larger than the bit width of <code>lhs</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_operator_10">3.1.3.9. operator&gt;&gt;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Shift <code>lhs</code> right by <code>rhs</code> bit positions and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are demoted to a narrower type, down to the natural word size of
the underlying architecture, if all possible results will fit.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A compilation error will result if the <code>rhs</code> requirement doesn&#8217;t exclude
all negative numbers or numbers larger than the bit width of <code>lhs</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_operator_11">3.1.3.10. operator|</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Bitwise OR the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the wider type of <code>lhs</code> and <code>rhs</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_12">3.1.3.11. operator&amp;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Bitwise AND the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the narrower type of <code>lhs</code> and <code>rhs</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_13">3.1.3.12. operator^</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">^</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Bitwise XOR the underlying values of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the wider type of <code>lhs</code> and <code>rhs</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_abs">3.1.3.13. abs</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">abs</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">v</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calculate the absolute value of <code>v</code> and return the result.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bit_width">3.1.3.14. bit_width</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">bit_width</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">v</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calculate the bit width of <code>v</code> and return the result.</p>
</div>
<div class="paragraph">
<p>Value types are demoted to a narrower type, down to the natural word size of
the underlying architecture, if all possible results will fit.</p>
</div>
</div>
<div class="sect4">
<h5 id="_min">3.1.3.15. min</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">min</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calculate the minimum of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the narrower type of <code>lhs</code> and <code>rhs</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_max">3.1.3.16. max</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">max</span><span class="p">(</span><span class="n">Var</span> <span class="k">auto</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Var</span> <span class="k">auto</span> <span class="n">rhs</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calculate the maximum of <code>lhs</code> and <code>rhs</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the wider type of <code>lhs</code> and <code>rhs</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_clamp">3.1.3.17. clamp</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">clamp</span><span class="p">(</span>
    <span class="n">Var</span> <span class="k">auto</span> <span class="n">value</span><span class="p">,</span>
    <span class="n">Var</span> <span class="k">auto</span> <span class="n">min_val</span><span class="p">,</span>
    <span class="n">Var</span> <span class="k">auto</span> <span class="n">max_val</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Clamps <code>value</code> from <code>min_val</code> to <code>max_val</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the underlying type of <code>max_val</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">clamp</span><span class="p">(</span>
    <span class="k">auto</span> <span class="n">unsafe_value</span><span class="p">,</span>
    <span class="n">Var</span> <span class="k">auto</span> <span class="n">min_val</span><span class="p">,</span>
    <span class="n">Var</span> <span class="k">auto</span> <span class="n">max_val</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Clamps <code>value</code> from <code>min_val</code> to <code>max_val</code> and return the result.</p>
</div>
<div class="paragraph">
<p>The resulting value type is the underlying type of <code>max_val</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_safedsl">3.2. <code>safe::dsl</code></h3>
<div class="sect4">
<h5 id="_operator_14">3.2.1. operator==</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\$A = B\$</p>
</div>
<div class="paragraph">
<p>Return true if the set of numbers represented by the requirements <code>A</code> and
<code>B</code> contain exactly the same numbers.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_15">3.2.2. operator!=</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\$A != B\$</p>
</div>
<div class="paragraph">
<p>Return true if the set of numbers represented by the requirements <code>A</code> and
<code>B</code> contain at least one different number.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_16">3.2.3. operator<=</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\$A subseteq B\$</p>
</div>
<div class="paragraph">
<p>Return true if the set of numbers represented by the requirement <code>rhs</code> contains
all the numbers <code>lhs</code> does.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_17">3.2.4. operator>=</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\$A supe B\$</p>
</div>
<div class="paragraph">
<p>Return true if the set of numbers represented by the requirement <code>lhs</code> contains
all the numbers <code>rhs</code> does.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_18">3.2.5. operator||</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">||</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\$A uu B\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_19">3.2.6. operator&amp;&amp;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\$A nn B\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_20">3.2.7. operator+</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a + b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_21">3.2.8. operator-</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a - b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_22">3.2.9. operator*</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a * b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_23">3.2.10. operator/</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a / b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_24">3.2.11. operator%</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a % b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_abs_2">3.2.12. abs</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">abs</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${\|a\| \| a in A}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_min_2">3.2.13. min</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">min</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${min(a, b) \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_max_2">3.2.14. max</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">max</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${max(a, b) \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_25">3.2.15. operator&amp;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a\ &amp;\ b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_26">3.2.16. operator|</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a \| b \ \|\ a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_27">3.2.17. operator^</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">^</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a\ o+\ b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_28">3.2.18. operator~</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${~a \| a in A}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_29">3.2.19. operator&lt;&lt;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a " &lt;&lt; " b \| a in A, b in B}\$</p>
</div>
</div>
<div class="sect4">
<h5 id="_operator_30">3.2.20. operator&gt;&gt;</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">auto</span> <span class="n">A</span><span class="p">,</span> <span class="k">auto</span> <span class="n">B</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>\${a " &gt;&gt; " b \| a in A, b in B}\$</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_safearray">3.3. <code>safe::array</code></h3>

</div>
<div class="sect2">
<h3 id="_safeinteger">3.4. <code>safe::integer</code></h3>

</div>
<div class="sect2">
<h3 id="_algorithms">3.5. Algorithms</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements_dsl_theory_of_operation">4. Requirements DSL Theory of Operation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_subset_is_left_distributive_over_union_of_disjoint_intervals">4.1. Subset is Left Distributive Over Union of Disjoint Intervals</h3>
<div class="paragraph">
<p>For intervals A, B, and C, where B and C are disjoint, the following holds
true:</p>
</div>
<div class="paragraph">
<p>\$A subseteq (B uu C) -= (A subseteq B) vee (A subseteq C)\$</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given \$A subseteq (B uu C)\$</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$x in A -&gt; x in (B uu C)\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Definition:Subset">Definition of subset</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$x in A -&gt; (x in B vee x in C)\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Definition:Set_Union">Definition of union</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$(x in A -&gt; x in B) vee (x in A -&gt; x in C)\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Implication_is_Left_Distributive_over_Disjunction">Implication is left distributive over disjunction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$(A subseteq B) vee (A subseteq C)\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Definition:Subset">Definition of subset</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$therefore A subseteq (B uu C) -= (A subseteq B) vee (A subseteq C)\$</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_subset_is_right_anti_distributive_over_union_of_disjoint_intervals">4.2. Subset is Right Anti-Distributive over Union of Disjoint Intervals</h3>
<div class="paragraph">
<p>For intervals A, B, and C, where B and C are disjoint, the following holds
true:</p>
</div>
<div class="paragraph">
<p>\$(A uu B) subseteq C -= (A subseteq C) wedge (B subseteq C)\$</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given \$(A uu B) subseteq C\$</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$x in (A uu B) -&gt; x in C\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Definition:Subset">Definition of subset</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$(x in A vee x in B) -&gt; x in C\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Definition:Set_Union">Definition of union</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$(x in A -&gt; x in C) wedge (x in B -&gt; x in C)\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://en.wikipedia.org/wiki/Distributive_property#Notions_of_antidistributivity">Implication is right anti-distributive over disjunction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$(A subseteq C) wedge (B subseteq C)\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://proofwiki.org/wiki/Definition:Subset">Definition of subset</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$therefore (A uu B) subseteq C -= (A subseteq C) wedge (B subseteq C)\$</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_subsets_of_unions_of_disjoint_intervals">4.3. Subsets of Unions of Disjoint Intervals</h3>
<div class="paragraph">
<p>For disjoint intervals A and B, and disjoint intervals C and D, the following
holds true:</p>
</div>
<div class="paragraph">
<p>\$(A uu B) subseteq (C uu D) -= {(A subseteq C) vee (A subseteq D)} wedge {(B subseteq C) vee (B subseteq D)}\$</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given \$(A uu B) subseteq (C uu D)\$</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${A subseteq (C uu D)} wedge {B subseteq (C uu D)}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subset is Right Anti-Distributive over Union of Disjoint Intervals</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\${(A subseteq C) vee (A subseteq D)} wedge {(B subseteq C) vee (B subseteq D)}\$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subset is Left Distributive Over Union of Disjoint Intervals</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$therefore (A uu B) subseteq (C uu D) -= {(A subseteq C) vee (A subseteq D)} wedge {(B subseteq C) vee (B subseteq D)}\$</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_cartesian_product_of_unions">4.4. Cartesian Product of Unions</h3>
<div class="paragraph">
<p>\$(A uu B) xx (C uu D) -= (A xx C) uu (B xx D) uu (A xx D) uu (B xx C)\$</p>
</div>
<div class="paragraph">
<p><a href="https://proofwiki.org/wiki/Cartesian_Product_of_Unions" class="bare">https://proofwiki.org/wiki/Cartesian_Product_of_Unions</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_cartesian_product_is_distributive_over_union">4.5. Cartesian Product is Distributive Over Union</h3>
<div class="paragraph">
<p>\$A xx (B uu C) -= (A xx B) uu (A xx C)\$</p>
</div>
<div class="paragraph">
<p>\$(B uu C) xx A -= (B xx A) uu (C xx A)\$</p>
</div>
<div class="paragraph">
<p><a href="https://proofwiki.org/wiki/Cartesian_Product_Distributes_over_Union" class="bare">https://proofwiki.org/wiki/Cartesian_Product_Distributes_over_Union</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.0<br>
Last updated 2023-04-28 16:05:45 -0700
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>